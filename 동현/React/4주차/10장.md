# 10장. 웹 스토리지 이용하기

**학습 목표**

- 웹 스토리지가 무엇인지 알아봅니다.
- [감정 일기장] 데이터를 웹 스토리지에 영구 저장하는 법을 알아봅니다.

## 웹 스토리지

웹 스토리지(Web Storage)는 한마디로 웹 브라우저가 제공하는 데이터베이스이다.

### 웹 스토리지가 필요한 이유

브라우저는 사용자가 여러 페이지를 동시에 탐색하도록 복수의 탭을 지원한다. 이때 탭을 새로고침하면 브라우저는 해당 탭에서 보관하던 데이터를 삭제하고 페이지를 다시 불러온다. 리액트 앱의 State나 변수에 저장된 데이터는 브라우저의 탭에 보관된다. 따라서 탭을 없애거나 새로고침하면 데이터는 모두 사라진다. 탭에 임시로 보관되어 있는 셈이다.
새로고침하거나 탭을 종료해도 데이터를 사라지지 않게 하려면 데이터베이스와 같은 별도의 저장 공간에 두어야 한다. 대다수의 웹 서비스는 데이터베이스를 별도의 저장 공간인 서버에 두고 사용한다. 그러나 서버에 데이터를 저장하는 방식은 번거로움이 따르므로 웹 브라우저가 제공하는 데이터베이스인 웹 스토리지를 이용하면 된다.

### 웹 스토리지를 소개합니다

브라우저에는 쿠키, 웹 스토리지, indexedDB 등에 활용할 다양한 저장 공간이 있다. 웹 스토리지는 서버가 아닌 클라이언트, 즉 사용자의 PC를 활용해 데이터를 저장하는 HTML5의 새로운 기능이다. 웹 스토리지는 쿠키 기능과 매우 유사하다. 다만 쿠키가 저장할 수 있는 공간이 4KB인 반면, 웹 스토리지는 약 5MB의 데이터를 저장할 수 있다. 웹 스토리지는 자바스크립트 객체처럼 키와 값 쌍으로 이루어진 데이터를 저장한다. 사용법도 간단하며 데이터의 유효 기간도 따로 없다. 웹 스토리지는 저장 방식에 따라 다음과 같이 두 가지로 구분한다.

**로컬 스토리지**

별도 라이브러리 없이 window 객체를 이용하는 방식으로, window.localStorage 명령을 사용한다. 이때 localStorage라는 이름으로 변수나 함수를 선언하지 않는다면, window는 생략할 수 있다. 로컬 스토리지에 저장한 데이터는 브라우저를 종료해도 유지된다. 직접 삭제하지 않는 한, 저장 데이터는 반영구적으로 보관할 수 있다. 또한 로컬 스토리지는 도메인별로도 생성할 수 있는데, 주소가 다르면 해당 도메인의 로컬 스토리지에는 접근할 수 없다. 탭이 다르더라도 도메인 주소가 같다면 같은 로컬 스토리지를 사용할 수 있다.

**세션 스토리지**

로컬 스토리지처럼 별도의 라이브러리 없이 window 객체를 이용하는 방식으로, window.sessionStorage 명령으로 사용한다. 다만 세션 스토리지는 탭 단위로 데이터를 보관하는 방식으로 탭을 종료하면 데이터도 삭제된다. 당연히 브라우저를 종료하면 세션 스토리지에 보관된 데이터 역시 모두 삭제된다. 탭을 종료하지 않으면 직접 데이터를 삭제하지 않는 한, 데이터를 계속 보관할 수 있다. 즉, 새로고침이 발생해도 탭을 종료하지 않는 이상 데이터는 삭제되지 않는다.

### 로컬 스토리지 사용법

**데이터 생성/수정하기**

로컬 스토리지에 데이터를 보관하는 방법은 매우 간단하다. 다음과 같이 객체 localStorage의 메서드 setItem을 호출해 인수로 key와 value를 전달하면 된다. 단 key는 반드시 문자열이여야 한다.

```javascript
localStorage.setItem("key", value);
```

로컬 스토리지는 값을 문자열로 저장한다. 저장하려는 value가 참조형 객체라면 다음과 같이 객체를 문자열로 변환하는 JSON.stringify 메서드를 사용해야 한다.

```javascript
localStorage.setItem("key", JSON.stringify(value));
```

setItem 메서드로 로컬 스토리지에 저아한 데이터는 삭제하지 않는 이상 반영구적으로 보관된다. 만약 이미 존재하는 key를 인수로 전달하면 데이터를 덮어쓴다. 실무에서는 일부로 이 기능을 이용해 데이터를 수정하기도 한다.

**데이터 꺼내기**

로컬 스토리지에서 데이터를 꺼내는 방법은 getItem 메서드를 호출해 인수로 key를 전달하면 된다. 그럼 getItem 메서드는 key와 일치하는 value를 반환한다. 이때도 key는 반드시 문자열이여야 한다.

```javascript
localStorage.setItem("key");
```

로컬 스토리지에서 꺼내려는 데이터의 value가 앞서 JSON.stringify 메서드로 객체를 문자열로 변환한 값이라면, 다음과 같이 JSON.parse 메서드로 문자열을 원래의 객체 상태로 되돌릴 수 있다.

```javascript
const data = JSON.parse(localStorage.getItem("key"));
```

getItem 메서드는 일치하는 데이터가 없으면 undefined 값을 반환한다. 한 가지 주의할 점은 JSON.parse에 전달하는 값이 undefined면 오류가 발생한다. 따라서 다음과 같이 getItem 메서드로 꺼낸 값이 유효한지 먼저 검사해야 한다.

```javascript
const rawData = localStorage.getItem("key");
if (rawData) {
    const data = JSON.parse(rawData);
}
```

**데이터 지우기**

로컬 스토리지에 저장된 데이터를 지울 때는 removeItem 메서드를 호출한다. 인수로 삭제하려는 데이터의 key를 전달하면 된다.

```javascript
localStorage.removeItem("key");
```

### 세션 스토리지 사용법

**데이터 생성/수정하기**

세션 스토리지에서 데이터를 생성하거나 수정하려면 로컬 스토리지와 동일하게 setItem 메서드를 호출해 인수로 key와 value를 전달한다.

```javascript
sessionStorage.setItem("key", value);
```

저장하려는 데이터가 객체라면 로컬 스토리지처럼 JSON.stringify 메서드로 문자열로 변환해 저장한다.

```javascript
sessionStorage.setItem("key", JSON.stringify(value));
```

**데이터 꺼내기**

데이터를 꺼낼 때도 로컬 스토리지처럼 setItem을 사용하며 key를 인수로 전달한다.

```javascript
sessionStorage.getItem("key");
```

꺼내려는 데이터가 원래 객체라면 로컬 스토리지처럼 JSON.parse 메서드로 문자열을 객체로 변환해 반환한다. 이때 JSON.parse에 undefined 값을 전달하지 않도록 주의한다.

```javascript
const rawData = sessionStorage.getItem("key");
if (rawData) {
    const data = JSON.parse(rawData);
}
```

**데이터 지우기**

데이터를 지울 때도 로컬 스토리지처럼 removeItem 메서드에 삭제 대상 데이터의 key를 전달하면 된다.

```javascript
sessionStorage.removeItem("key");
```