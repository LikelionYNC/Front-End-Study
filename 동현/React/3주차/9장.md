# 9장. 컴포넌트 트리에 데이터 공급하기

**학습 목표**

- Context가 무엇인지 알아봅니다.
- Context로 [할 일 관리] 앱을 리팩토링합니다.

## Context

리액트 컴포넌트 트리 전체를 대상으로 데이터를 공급하는 기능인 Context를 살펴보자.

### Context를 사용하는 이유

Context를 사용하는 이유는 'Props Drilling' 문제를 해결하기 위함이다. Props Drilling 문제는 리액트 컴포넌트 계층 구조에서 컴포넌트 간에 값을 전달할 때 발생한다.
리액트에서는 컴포넌트 간에 데이터를 전달하기 위해 Props를 사용한다. Props는 컴포넌트 트리에서 언제나 부모에서 자식으로 단방향으로 전달된다. 리액트에서는 자식과 자식, 즉 트리에서 2단계 이상 떨어져 있는 컴포넌트에 직접 데이터를 전달하는 것이 불가능하다.
원하는 목적지까지 데이터를 전달하기 위해서는 경로상에 있는 모든 컴포넌트에 일일히 Props를 전달해야 한다. Props를 전달하는 과정이 마치 드릴로 땅을 파고 내려가는 것과 같다고 하여, 이를 Props Drilling 문제라고 한다. Props Drilling은 컴포넌트 사이의 데이터 교환 구조를 파악하기 어렵게 한다. 또한 Props를 수정하게 되면 그것을 공유하는 여러 컴포넌트를 모두 살펴 봐야 하므로 코드의 유지 보수를 어렵게 한다.

### Context란?

Context는 문맥이라는 뜻으로 스인다. 글에서 문맥이란 글이 지닌 방향성이다. 좀 더 구체적으로 표현하면 문장이나 문단이 궁극적으로 전달하려는 이야기와 뜻이다.
리액트의 Context 역시 이와 비슷하다. 예를 들어 '컴포넌트 A와 컴포넌트 B가 동일한 문맥 아래 있다'라는 말은 컴포넌트 A와 B가 동일한 목적을 가지고 있다는 뜻으로 이해할 수 있다.
리액트에서 Context는 같은 문맥 아래에 있는 컴포넌트 그룹에 데이터를 공급하는 기능이라는 의미로 사용된다. Context를 이용하면 단계마다 일일히 Props를 전달하지 않고도 컴포넌트 트리 전역에 데이터를 공급할 수 있어 Props　Drilling 문제를 간단히 해결할 수 있다.
Context를 사용할 때에는 여러 컴포넌트를 하나의 Context로 묶으면 된다. 그리고 이 Context에 값을 공급하면 Context Drilling을 야기하지 않으면서 컴포넌트 간에 값을 공유할 수 있다.

### ContextAPI

ContextAPI는 Context를 만들고 다루는 리액트 기능이다.

### Context 만들기

React.createContext를 이용하면 새로운 Context를 만들 수 있다.

```jsx
const MyContext = React.createContext(defaultValue);
```

- createContext 메서드를 호출해 새로운 Context를 만든다. 인수로 전달하는 값은 Context의 기본값으로 생략할 수 있다.

### Context애 데이터 공급하기

Context에서 새 데이터를 공급하려면 Context.Provider 기능을 사용해야 한다.
Context.Provider는 Context객체에 기본으로 포함된 컴포넌트이다.

```jsx
const MyContext = React.createContext(defaultValue);

function App () {
    const data = 'data';
    return (
        <div>
            <Header />
            <MyContext.Provider value={data}>
                <Body />
            </MyContext.Provider>
        </div>
    );
}

export default App;
```

- MyContext.Provide를 App 컴포넌트의 자식으로 배치한다. 이제 Provider가 설정한 자식, 자손 컴포넌트들은 MyContext로 묶여 이 객체에서 공급하는 데이터를 사용할 수 있다. Provider컴포넌트에 Props(value)를 전달해 MyContext가 공급할 값을 설정한다.

Provider 컴포넌트는 Props로 공급할 데이터를 받아, 컴포넌트 트리에서 자신보다 하위에 있는 모든 컴포넌트에 데이터를 공급한다.

### Context가 공급하는 데이터 사용하기

useContext는 특정 Context가 공급하는 데이터를 불러오는 리액트 훅이다.

```jsx
const MyContext = React.createContext(defaultValue);

function App () {
    (...)
}

function Main () {
    const data = useContext(MyContext);
    (...)
}
```

- useContext를 호출하고 인수로 값을 공급할 Context를 전달한다. 함수 useContext는 해당 Context가 공급하는 값을 반환하다. 반환할 값을 변수 data에 저장한다.

useContext를 이용하면 자신이 속한 그룹의 Context가 제공하는 값을 불러올 수 있다. 만약 useContext를 호출한 컴포넌트가 인수로 전달한 Context 그룹에 속해 있지 않으면 오류가 발생한다. 코드상의 Main 컴포넌트는 MyContext 그룹에 속하기 때문에 문제가 발생하지 않는다.

요약하자면 createContext를 이용해 Context를 만들고, 값을 공급할 컴포넌트를 Context.Provider로 감싼다. 그리고 함수 useContext를 호출해 Context가 공급하는 값을 불러와 사용한다.