# 7장. useReducer와 상태 관리

**학습 목표**

- 상태 변화의 개념과 useReducer에 대해 알아봅니다.
- [할 일 관리] 앱을 useReducer를 이용해 업그레이드 합니다.

## useReducer 이해하기

리액트 훅인 useReducer를 이용하면 컴포넌트에서 상태 변화 코드를 쉽게 분리할 수 있다.

### 상태 변화 코드란?

상태 변화 코드란 State값을 변경하는 코드이다.

상태 변화 코드를 컴포넌트에서 분리한다는 말은 컴포넌트 내부에 작성했던 상태 변화 코드를 외부로 옮겨 작성한다는 말이다. 허나 useState를 이용해 작성한 State는 상태 변화 코드 분리가 불가능하다. 컴포넌트 안에서 선언했기 때문이다. useState를 이용해 State를 생성하면 상태 변화 코드는 반드시 컴포넌트 안에 작성해야 한다. 반면 useReducer를 사용하면 상태 변화 코드를 컴포넌트 밖으로 분리할 수 있다.

### useReducer의 기본 사용법

useReducer는 useState와 더불어 리액트 컴포넌트에서 State를 관리하는 리액트 훅이다. useReducer는 State 관리를 컴포넌트 내부가 아닌 외부에서 할 수 있게 만든다. 그래서 useState와 달리 State를 관리하는 상태 변화 코드를 컴포넌트와 분리할 수 있다. useReducer를 적용하는 방법은 아래와 같다.

```jsx
// useReducer의 용법

const [count, dispatch] = useReducer(reducer, 0);

/*
count <= state 변수
dispatch <= 상태 변화 촉발 함수

reducer <= 변화 함수
0 <= 초깃값
*/
```

```jsx
import { useReducer } from "react";

function reducer () {} // 컴포넌트 밖에 reducer 함수를 만든다

function TestComp () {
	const [count, dispatch] = useReducer(reducer, 0);
	
	return (
		<div>
			<h4>테스트 컴포넌트</h4>
			<div>
				<bold>{count}</bold>
			</div>
			<div>
				<button onClick={() => dispatch({ type: "INCREASE", data: 1 })}>
					+
				</button>
				<button onClick={() => dispatch({ type: "DECREASE", data: 1 })}>
					-
				</button>
			</div>
		</div>
	);	
}

export default TestComp;
```

< + > 버튼을 클릭하면 카운트값을 1 만큼 늘려야 한다. 따라서 상태 변화가 필요할 때 이를 촉발하는 함수인 dispatch를 호출한다. 이때 함수 dispatch에서는 인수로 객체를 전달하는데, 이 객체는 State의 변경 정보를 담고 있다. 이 객체를 다른 표현으로는 ‘action 객체’라고 한다.

< + > 버튼을 클릭했을 때, 함수 dispatch는 2개의 프로퍼티로 이루어진 action 객체를 인수로 전달한다. 두 프로퍼티 중 type은 어떤 상황이 발생했는지를 나타낸다. < + > 버튼을 클릭했으므로 type 프로퍼티에는 증가를 의미하는 INCREASE를 값으로 설정한다. data 프로퍼티는 상태 변화에 필요한 값이다. < + > 버튼을 클릭하면 카운트를 1 만큼 늘리므로 data 프로퍼티의 값은 1로 설정된다. < - > 버튼 역시 같은 구조이다.

그러나 아직 버튼을 클릭해도 카운트값은 늘거나 줄지 않는다. 그 이유는 실제 상태 변화는 함수 reducer에서 일어나기 때문이다. dispatch를 호출하면 함수 reducer가 실행되는데, 이 함수가 반환하는 값이 새로운 State 값이 된다.

정리하면 useReducer가 반환하는 함수 dispatch를 호출하면 useReducer는 함수 reducer을 호출하고, 이 함수가 반환하는 값이 State를 업데이트한다. 

다음과 같이 TestComp에서 함수 reducer를 작성한다.

```jsx
function reducer () {
	switch (action.type) {
		case "INCREASE":
			return state + action.data;
		case "DECREASE":
			return state - action.dara;
		default:
			return state;
	}
}
```

- 함수 reducer에는 2개의 매개변수가 있다. 첫 번째 매개변수 state에는 현재 state의 값이 저장된다. 두 번째 매개변수 action에는 함수 dispatch를 호출하면서 인수로 전달한 action 객체가 저장된다.
- 함수 reducer가 반환하는 값이 새로운 State값이 된다. action 객체의 type이 INCREASE면 기존 State 값에 action 객체의 data값을 더해 반환한다.
- action 객체의 type이 DECREASE면 기존 State 값에 action 객체의 data 값을 빼서 반환한다.
- action 객체의 type이 INCREASE도 DECREASE도 아니면 매개변수 state 값을 그대로 반환하므로 아무런 상태 변화도 이루어지지 않는다.

useReducer는 함수 reducer를 이용해 상태 변화 코드를 컴포넌트 외부로 분리한다. 만약 새로운 상태 변화가 필요하면 함수 reducer를 수정하면 그만이다.